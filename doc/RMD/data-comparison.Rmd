---
title: "R Notebook"
output: html_notebook
---

This document serves to compare the data presented in Sydney's original XLSX 
file and the one generated by Amaradasa. He cleaned it up by inserting "unk" for
missing values. Because there was no file trail for this other than his own
comment, I will compare these two.

```{r setup, include = FALSE}
knitr::opts_knit$set(root.dir = "../../")
```


```{r}
library('tidyverse')
library('readxl')
```

Sydney's data is stored in excel format, so we have to use readxl to parse it.
First, we want to know what sheets exist.

```{r}
excel_sheets("../Analysis4 ForManu/A1_Copy of binned-genotypes_SE.xlsx")
```

We will be using the GenAlexBinned sheet. From my talks with Sydney, this sheet
contains the SSR data binned into the expected allelels. Note, this sequence of
data input and cleaning was done iteratively and what you are seeing is the 
final result.

There are always quirks with the data when it's in excel. Often, there are too
many rows, so we have to remove them with `slice()`.

Quirks specific to thse data:

 - GenAlEx format has an extra header region that should be ignored
 - The loci are formatted like so: `110-4(F)`, where the `(F)` part is not 
   informative
 - The header for the strata has extra information
 

 
```{r sydney_data}
syd <- read_excel("../Analysis4 ForManu/A1_Copy of binned-genotypes_SE.xlsx", 
                sheet = "GenAlexBinned", skip = 1) %>%
  select(-1) %>%                # removing first column, which is empty
  gather(locus, allele, -1) %>% # gather all loci into tidy columns
  mutate(locus = trimws(locus) %>% substr(1, nchar(.) - 3)) %>% # remove (F) designator
  spread(locus, allele) %>%     # spread data out with individual loci in columns
  separate(iso_st_mcg_org_loc_yr_hst_cult_rep, 
           c("Isolate", "Severity", "MCG", "State", "Source", "Year", "Host"), 
           sep = "_") %>%
  mutate_if(is.character, trimws) %>% # Trim whitespace forom all character columns
  mutate(Severity = as.numeric(Severity)) %>%
  slice(-n()) # remove last row
syd
```

