---
title: "Assessing Virulence by MCG"
output: 
  html_notebook:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = PROJHOME)
```

```{r load_packages, message = FALSE, warning = FALSE}
library("tidyverse")
```

# Purpose

This document is to assess virulence associated with the 10 most common MCGs. We
can get this from the cleaned data set that we saved in the
`data-comparison.Rmd` file. Note, we will be labelling the plot with 
"Aggressiveness" as that is the preferred term.

```{r load_data}
cols(
  .default = col_integer(),
  Severity = col_double(),
  Region = col_character(),
  Source = col_character(),
  Host = col_character()
)
dat <- read_csv(file.path(PROJHOME, "data", "clean_data.csv")) %>%
  select(MCG, Severity)
dat
```

Now, I can filter out the top 10 MCGs:

```{r filtering}
top_mcg <- dat %>% 
  group_by(MCG) %>%
  summarize(N = n()) %>%
  arrange(desc(N)) %>%
  slice(1:10) %>% 
  inner_join(dat, by = "MCG") %>%
  select(-N) %>%
  mutate(MCG = forcats::fct_inorder(as.character(MCG)))
top_mcg
```

## Visualizing distributions

```{r vis, fig.width = 5, fig.height = 3}
set.seed(2017-06-29)
ggplot(top_mcg, aes(x = MCG, y = Severity)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.25), alpha = 0.5) +
  theme_bw(base_size = 16, base_family = "Helvetica") +
  theme(aspect.ratio = 1/2) +
  labs(list(
    # title = "Aggressiveness for the top 10 MCGs",
    y = "Aggressiveness",
    x = "Mycelial Compatibility Group"
    ))
```

```{r virulence_table}
top_mcg %>% 
  group_by(MCG) %>%
  summarize(N = n(), 
            `Min Aggressiveness` = min(Severity),
            `Max Aggressiveness` = max(Severity),
            `Average Aggressiveness` = mean(Severity)
            ) %>%
  knitr::kable(digits = 2)
```


## ANOVA

The default ANOVA in R sets contrasts as `contrast.treatment`, which compares
everything to the first factor, considered the treatment. Since we are
interested in whether or not there IS a difference between samples, this will
be sufficient.

After the ANOVA, we performed a Tukey's Honest Significant Difference test to
see exactly what groups these fell into.

```{r anova, fig.width = 4, fig.height = 8}
ANOVA <- aov(Severity ~ MCG, data = top_mcg)
ANOVA
summary(ANOVA)
plot(TukeyHSD(ANOVA), las = 2)
agricolae::HSD.test(ANOVA, "MCG")$groups
```

There appears to be a significant effect at p = `r formatC(broom::tidy(ANOVA)$p.value[1])`.


<details>
<summary>Session Information</summary>

```{r, echo = FALSE}
options(width = 100)
devtools::session_info()
```

</details>
